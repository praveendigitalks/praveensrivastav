<!-- ======= About Section (SINGLE FORM) ======= -->
<section id="about" class="about section-show">
  <div class="about-me container">
    <div class="section-title">
      <h2>About</h2>
      <p>Add About Section</p>
    </div>

    <!-- ✅ SINGLE FORM - Everything inside -->
    <form (ngSubmit)="OnSubmit()" [formGroup]="aboutForm" class="php-email-form mt-4">

      <!-- Profile Image -->
      <div class="row">
        <div class="col-lg-4" data-aos="fade-right">
          <div class="profile-upload-circle" (click)="triggerFileInput()" (dragover)="onDragOver($event)"
            (drop)="onDrop($event)" [class.has-image]="selectedFile || previewUrl">

            <input type="file" #fileInput id="fileInput" (change)="onFileSelected($event)" hidden accept="image/*">

            <img [src]="previewUrl || '/favicon.jpeg'" class="preview-image" alt="" *ngIf="selectedFile || previewUrl">

            <div class="no-image-content" *ngIf="!selectedFile && !previewUrl">
              <i class="fas fa-plus-circle fa-5x"></i>
              <p>Click or Drop Image</p>
            </div>
          </div>
        </div>

        <!-- Basic Info -->
        <div class="col-lg-8 pt-4 pt-lg-0 content" data-aos="fade-left">
          <h3 class="info-box">
            <input type="text" class="form-control info-box" formControlName="position" placeholder="Position">
          </h3>

          <p class="fst-italic">
            <textarea class="form-control" formControlName="description" rows="3" placeholder="Description"></textarea>
          </p>

          <div class="row">
            <div class="col-lg-6">
              <ul>
                <li><input type="date" class="form-control" formControlName="dob"></li>
                <li><input type="tel" class="form-control" formControlName="phone"></li>
                <li><input type="text" class="form-control" formControlName="city"></li>
              </ul>
            </div>
            <div class="col-lg-6">
              <ul>
                <li><input type="text" class="form-control" formControlName="degree"></li>
                <li><input type="email" class="form-control" formControlName="email"></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- ✅ WEBSKILLS Inside Same Form -->
      <div class="skills container mt-5">
        <i class="fa-solid fa-plus" (click)="addSkill()"></i>
        <div class="section-title">
          <h2>Web Skills</h2>
        </div>

        <!-- ✅ Nested FormArray -->
        <div formArrayName="webskills">
          <div class="row skills-content">
            <div *ngFor="let skill of webskillsArray.controls; let i = index" [formGroupName]="i" class="col-lg-6">

              <div class="skill-item mb-3 p-3 border rounded">
                <div class="row align-items-center">
                  <div class="col-md-5">
                    <input formControlName="technology" class="form-control" placeholder="e.g. HTML, React, Node.js">
                  </div>

                  <div class="col-md-4">
                    <input type="range" formControlName="proficiency" class="form-range" min="0" max="100">
                    <small>{{ getProficiencyValue(i) }}%</small>
                  </div>

                  <div class="col-md-3 d-flex align-items-center">
                    <div class="progress me-2 flex-grow-1" style="height: 20px;">
                      <div class="progress-bar" [style.width.%]="getProficiencyValue(i)"></div>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-danger ms-1" (click)="removeSkill(i)">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="text-center py-4 text-muted" *ngIf="webskillsArray.length === 0">
            No skills added. Click "Add Skill" to start.
          </div>
        </div>
      </div>
      <!-- skills -->


      <!-- ======= prior-skill ======= -->
      <!-- ======= prior-skill ======= -->
      <div class="prior-skill container">
        <div class="section-title">
          <i class="fa-solid fa-plus" (click)="addpriorSkill()"></i>
          <h2>Prior Skills</h2>
        </div>

        <!-- ✅ ADD THIS ONE LINE - FormArray wrapper -->
        <div formArrayName="priorskills">
          <div class="row">
            <div class="col-lg-3 col-md-4 mt-4" *ngFor="let skill of priorSkillArray.controls; let i = index"
              [formGroupName]="i">
              <div class="text-center mb-2">
                <input type="text" formControlName="skillName" class="form-control" placeholder="skillName">

                <!-- ✅ PRIOR SKILLS helpers ONLY -->
                <i *ngIf="getIconTypePrior(i) === 'fontawesome'" [class]="getIconClassPrior(i)"
                  class="fs-2 text-primary">
                </i>

                <img *ngIf="getIconTypePrior(i) === 'image'" [src]="getIconUrlPrior(i)" class="img-fluid"
                  style="max-height: 40px;" alt="icon" />
              </div>

              <select formControlName="iconType" class="form-select form-select-sm">
                <option value="">Select Option</option>
                <option value="fontawesome">FontAwesome</option>
                <option value="image">Image URL</option>
              </select>

              <input formControlName="icon" class="form-control form-control-sm mt-1"
                placeholder="fa-brands fa-react OR image URL" />

              <button type="button" class="btn btn-sm btn-outline-danger mt-2 w-100" (click)="removepriorSkill(i)">
                <i class="fas fa-trash"></i> Remove
              </button>
            </div>
          </div>
        </div>
        <!-- ✅ END wrapper -->
      </div>

      <!-- End prior-skill -->

      <!-- ======= Counts for Company projects ======= -->
      <div class="counts container">
        <div class="row">

          <div class="col-lg-3 col-md-6">
            <div class="count-box">
              <i class="fa-regular fa-folder-open"></i>
              <input type="number" class="form-control count-number" formControlName="totalProject">
              <p>Total Projects</p>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 mt-5 mt-md-0">
            <div class="count-box">
              <input type="number" class="form-control count-number" formControlName="MeanStack">
              <p>MEAN STACK</p>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 mt-5 mt-lg-0">
            <div class="count-box">
              <input type="number" class="form-control count-number" formControlName="MernornextStack">
              <p>MERN STACK / Next JS Stack</p>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 mt-5 mt-lg-0">
            <div class="count-box">
              <input type="number" class="form-control count-number" formControlName="otherproject">
              <p>Other Projects</p>
            </div>
          </div>

        </div>
      </div>
      <!-- End Counts for company projects -->

      <!-- ======= Company Major Projects ======= -->
      <!-- ======= Company Projects ======= -->
      <div class="company-projects container mt-5">
        <div class="section-title">
          <i class="fa-solid fa-plus" (click)="addCompanyProject()"></i>
          <h2>Company Projects</h2>
        </div>

        <div formArrayName="companyProjects">
          <div *ngFor="let project of companyProjectsArray.controls; let projectIndex = index"
            [formGroupName]="projectIndex" class="card mb-4 p-4">

            <!-- Project Details -->
            <div class="row mb-3">
              <div class="col-md-12">
                <input formControlName="projectTitle" class="form-control mb-2" placeholder="Project Title">
                <input formControlName="projectBio" class="form-control mb-2" placeholder="Project Bio">
                <textarea formControlName="projectDescription" class="form-control" rows="3"
                  placeholder="Description"></textarea>
              </div>
            </div>

            <!-- Nested Technologies -->
            <div formArrayName="technologies">
              <h5>Technologies <i class="fa-solid fa-plus text-primary" (click)="addTech(projectIndex)"></i></h5>

              <!-- ✅ FIX: Use .controls for *ngFor -->
              <div class="row" *ngFor="let tech of getTechControls(projectIndex).controls; let techIndex = index"
                [formGroupName]="techIndex">
                <div class="col-md-6 mb-2">
                  <input formControlName="icon" class="form-control" placeholder="fa-brands fa-react OR image URL">
                  <select formControlName="iconType" class="form-select form-select-sm mt-1">
                    <option value="fontawesome">FontAwesome</option>
                    <option value="image">Image URL</option>
                  </select>
                </div>
                <div class="col-md-6 d-flex align-items-center">
                  <!-- Icon Preview -->
                  <i *ngIf="getTechIconType(projectIndex, techIndex) === 'fontawesome'"
                    [class]="getTechIcon(projectIndex, techIndex)" class="fs-2 text-primary me-2"></i>

                  <img *ngIf="getTechIconType(projectIndex, techIndex) === 'image'"
                    [src]="getTechIcon(projectIndex, techIndex)" class="img-fluid me-2" style="max-height: 40px;" />

                  <button type="button" class="btn btn-sm btn-outline-danger"
                    (click)="removeTech(projectIndex, techIndex)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>


            <!-- Remove Project -->
            <button type="button" class="btn btn-outline-danger mt-3" (click)="removeCompanyProject(projectIndex)">
              <i class="fas fa-trash"></i> Remove Project
            </button>
          </div>
        </div>
      </div>



      <!-- Submit Button -->
      <div class="text-center my-5">
        <button type="submit" class="btn btn-primary btn-lg">Save About</button>
      </div>
    </form>
  </div>
</section>
